{% extends 'core/base.html' %}

{% block title %}Resources - Disability Access Bridge{% endblock %}

{% block content %}
<div class="container" style="padding-top: 2rem; padding-bottom: 4rem;">
    
    <h1 style="margin-bottom: 10px;">Resource Directory</h1>
    <p style="margin-bottom: 30px; color: #666;">Find verified information on education, employment, and government schemes.</p>

    <div class="filter-controls">
        <form method="get" action="{% url 'resources' %}" style="display: flex; gap: 10px; flex-wrap: wrap; align-items: center;">
            <input type="text" name="q" placeholder="Search resources..." value="{{ query }}" class="form-input" style="flex: 2; min-width: 200px; margin-bottom: 0;">
            
            <select name="category" class="form-input" style="flex: 1; min-width: 150px; margin-bottom: 0;">
                <option value="">All Categories</option>
                {% for category in ALL_CATEGORIES %}
                    <option value="{{ category.id }}" {% if category.id == selected_category_id %}selected{% endif %}>
                        {{ category.name }}
                    </option>
                {% endfor %}
            </select>
            
            <button type="submit" class="btn">Search</button>
        </form>

        <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #ddd;">
            <label for="disability-select" style="font-weight: bold; margin-right: 10px;">Filter by Disability:</label>
            <select id="disability-select" class="form-input" style="width: auto; display: inline-block; margin: 0;" onchange="location = this.value;">
                <option value="">Select a Disability</option>
                {% for disability in all_disabilities %}
                    <option value="{% url 'disability_resources' disability_name=disability.name|slugify %}">
                        {{ disability.name }}
                    </option>
                {% endfor %}
            </select>
        </div>
    </div>
    
    <div class="resource-list-vertical">
        {% for item in resources %}
            <div class="resource-card-vertical" onclick="toggleCard(this)">
                
                <span class="category-badge">{{ item.category.name }}</span>
                
                <h3 class="resource-title">
                    {% if item.website_url %}
                        <a href="{{ item.website_url }}" target="_blank" onclick="event.stopPropagation();" title="Go to Website">
                            {{ item.title }} <span style="font-size: 0.8em;">ðŸ”—</span>
                        </a>
                    {% else %}
                        {{ item.title }}
                    {% endif %}
                </h3>
                
                <p class="short-desc">{{ item.description|truncatewords:25 }}</p>
                
                <div class="extra-details" style="display: none;">
                    <h4 style="margin-top: 0;">Full Description:</h4>
                    <p>{{ item.description }}</p>
                    
                    {% if item.contact_info %}
                        <div style="margin-top: 15px;">
                            <strong>ðŸ“ž Contact Info:</strong>
                            <p style="margin: 5px 0;">{{ item.contact_info|linebreaksbr }}</p>
                        </div>
                    {% endif %}
                </div>
                
                <small class="expand-hint">+ Click to view details</small>
            </div>
        {% empty %}
            <div class="message error">
                No resources found matching your search.
            </div>
        {% endfor %}
    </div>

</div>

<script>
    function toggleCard(cardElement) {
        const details = cardElement.querySelector('.extra-details');
        const hint = cardElement.querySelector('.expand-hint');
        const shortDesc = cardElement.querySelector('.short-desc');
        
        if (details.style.display === 'none') {
            // OPEN the card
            details.style.display = 'block';
            shortDesc.style.display = 'none'; 
            hint.innerText = '- Click to collapse';
            hint.style.color = '#333';
            cardElement.classList.add('expanded');
        } else {
            // CLOSE the card
            details.style.display = 'none';
            shortDesc.style.display = 'block'; 
            hint.innerText = '+ Click to view details';
            hint.style.color = ''; // Reset color
            cardElement.classList.remove('expanded');
        }
    }
</script>

{% endblock %}